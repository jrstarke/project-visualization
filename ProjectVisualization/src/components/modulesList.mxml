<?xml version="1.0" encoding="utf-8"?>
<mx:Panel xmlns:mx="http://www.adobe.com/2006/mxml" layout="vertical" title="Modules" titleStyleName="modulesStatusStyle" verticalGap="0" creationComplete="init()" borderThicknessBottom="5" borderThicknessLeft="5" borderThicknessRight="5">
	<mx:Style>
    	.modulesStatusStyle {
        	fontWeight: bold;
            color: white;
     	}
     	
     	.moduleLabelStyle	{
        	color: #4d4f4f;
        }
        
        .moduleLabelStyleHighlight	{
        	color: white;
        }
     </mx:Style>
     
     <mx:Script>
     	<![CDATA[
     		import mx.controls.ProgressBar;
     		import mx.rpc.events.ResultEvent;
     		import mx.rpc.http.HTTPService;
     		import com.adobe.serialization.json.JSON;
     		import mx.containers.HBox;
			import mx.controls.Label;
     		
     		public var highlightedModule:int = 0;
			private var getParentProject:ProjectVisualizaton = new ProjectVisualizaton();
			private var getSrvModules:HTTPService;
			private var getSrvModuleStats:HTTPService;
			public var moduleList:Array = new Array();
			
			//function to gain easy access to the parent class
			private function init():void
			{
				getParentProject =  this.parent.parent.parent.parent as ProjectVisualizaton;	
				
				getSrvModules = new HTTPService();
				getSrvModules.url = "http://localhost:8000/modules/"; 
				getSrvModules.resultFormat = "text";
				getSrvModules.addEventListener("result", processModuleList);
				
				getSrvModules.send();
			}
			
			private function processModuleList(event:ResultEvent):void{
				var decoded:Object = JSON.decode(event.result.toString());
				moduleList = decoded as Array;
				moduleList = moduleList.reverse();
				
				var i:int;
				for(i=0; i<moduleList.length; i++){
					var moduleHBox:HBox = new HBox();
					var moduleNameLabel:Label = new Label();
					var moduleProgressBar:ProgressBar = new ProgressBar();
			
					moduleHBox.name = moduleList[i].pk + "";
					moduleProgressBar.name = moduleList[i].pk + "Bar";
					moduleNameLabel.name = moduleList[i].pk + "Label";					
					moduleNameLabel.text = "" + moduleList[i].name
					
					moduleNameLabel.width = 170;
					
					//moduleHBox.setStyle("border", "none");
					moduleHBox.opaqueBackground = 0xffffff;	
					moduleNameLabel.styleName = "moduleLabelStyle";
						
					 moduleHBox.setStyle("paddingTop",1);
					moduleHBox.setStyle("paddingBottom",1);
					moduleHBox.setStyle("paddingLeft",1);	
					moduleHBox.setStyle("paddingRight",1); 	
					moduleHBox.setStyle("verticalGap", 0);
					
					moduleProgressBar.mode = "manual";
					moduleProgressBar.label = "";
					moduleProgressBar.labelPlacement = "right";
					moduleProgressBar.setStyle("verticalCenter", 0);
					moduleProgressBar.setStyle("verticalGap", 0);
					moduleProgressBar.width = 50;
					
					moduleHBox.addEventListener(MouseEvent.MOUSE_OVER, eventMouseOver);
					moduleHBox.addEventListener(MouseEvent.CLICK, eventMouseClick);
					
					moduleHBox.addChild(moduleNameLabel);
					moduleHBox.addChild(moduleProgressBar);
					this.addChildAt(moduleHBox, 0);
				}
			}
			
			//perform click to hightlight the module name and set the filter
			private function eventMouseClick(e:MouseEvent):void
			{			
				var currentHBox:HBox = new HBox();
				currentHBox = e.currentTarget as HBox;
				var currentLabel:Label = new Label();
				currentLabel = currentHBox.getChildAt(0) as Label;
				var tempStyleName:String = currentLabel.styleName.toString();
					
				//reset all selected modules
				var i:int;
				for(i=0; i<moduleList.length; i++)
				{
					var tempHBox:HBox = new HBox();
					tempHBox = getParentProject.modulesList.getChildByName(moduleList[i].pk) as HBox;
					
					var tempLabel:Label = new Label();
					tempLabel = tempHBox.getChildAt(0) as Label;
					tempHBox.opaqueBackground = 0xffffff;
					tempLabel.styleName = "authorLabelStyle";
				}
				
				//check to see if we must deselect a module
				if(tempStyleName != "moduleLabelStyleHighlight"){
					currentHBox.opaqueBackground = 0x4d4f4f;
					currentLabel.styleName = "moduleLabelStyleHighlight";
					
					highlightedModule = int(currentHBox.name);
					
					getSrvModuleStats = new HTTPService();
					getSrvModuleStats.url = "http://localhost:8000/selectedstats/" + getParentProject.authorInfoList.highlightedAuthor + "/" + highlightedModule + "/"; 
					getSrvModuleStats.resultFormat = "text";
					getSrvModuleStats.addEventListener("result", processModuleStats);
					getSrvModuleStats.send();
				}
				
				else
				{
					currentHBox.opaqueBackground = 0xffffff;
					currentLabel.styleName = "moduleLabelStyle";
					highlightedModule = 0;
					
					getSrvModuleStats = new HTTPService();
					getSrvModuleStats.url = "http://localhost:8000/selectedstats/" + getParentProject.authorInfoList.highlightedAuthor + "/" + highlightedModule + "/"; 
					getSrvModuleStats.resultFormat = "text";
					getSrvModuleStats.addEventListener("result", processModuleStats);
					getSrvModuleStats.send();
				}
				
				//reset the events list
				getParentProject.eventInfoList.removeAllEventsFromList();
				getParentProject.eventInfoList.maxEventListCount = 0;
				getParentProject.controllerCanvas.eventIndex = 0;
				var index:int = 0;
				getParentProject.controllerCanvas.processAtPixelMoveStart(index);
			}
			
			private function processModuleStats(event:ResultEvent):void
			{
				if(highlightedModule == 0 && getParentProject.authorInfoList.highlightedAuthor == 0)
					getParentProject.controllerCanvas.processGetResult(getSrvModuleStats.lastResult.toString(), 1);
				else
					getParentProject.controllerCanvas.processGetResult(getSrvModuleStats.lastResult.toString(), 2);
			}
			
			//perform mouse over effects, pause playback
			private function eventMouseOver(e:MouseEvent):void
			{
				getParentProject.controllerCanvas.eventTimer.stop();
				
				var currentHBox:HBox = new HBox();
				currentHBox = e.currentTarget as HBox;
				
				currentHBox.addEventListener(MouseEvent.MOUSE_OUT, eventMouseOut);

				//currentHBox.setStyle("borderStyle", "solid");
				if(currentHBox.opaqueBackground != 0x4d4f4f) 
					currentHBox.opaqueBackground = 0xeaeaea;	
				
				/* currentHBox.setStyle("paddingTop",0);
				currentHBox.setStyle("paddingBottom",0);
				currentHBox.setStyle("paddingLeft",0);
				currentHBox.setStyle("paddingRight",0); */
				
				//highlight associated event if possible
				var i:int;
				for(i=0; i<getParentProject.eventInfoList.eventList.length; i++)
				{
					var j:int;
					for(j=0; j<getParentProject.eventInfoList.eventList[i].modules.length;j++)
					{
						if(currentHBox.name == getParentProject.eventInfoList.eventList[i].modules[j])
						{
							var eventHBox:HBox = new HBox();
							eventHBox = getParentProject.eventInfoList.getChildByName(getParentProject.eventInfoList.eventList[i].pk + "event") as HBox;
							//eventHBox.setStyle("borderStyle", "solid");
							eventHBox.opaqueBackground = 0xeaeaea;	
							
							/* eventHBox.setStyle("paddingTop",0);
							eventHBox.setStyle("paddingBottom",0);
							eventHBox.setStyle("paddingLeft",0);	
							eventHBox.setStyle("paddingRight",0); */					
						}
					}
				} 
			}

			//perform mouse out effects, resume playback
			private function eventMouseOut(e:MouseEvent):void
			{
				//check if the player is playing
				//removed for demo!
				//if(getParentProject.controllerCanvas.playerButton.source == "assets/images/button-icon-pause.png")
					getParentProject.controllerCanvas.eventTimer.start();
				
				var currentHBox:HBox = new HBox();
				currentHBox = e.currentTarget as HBox;
				//currentHBox.setStyle("borderStyle", "none");
				if(currentHBox.opaqueBackground != 0x4d4f4f) 
					currentHBox.opaqueBackground = 0xffffff;	
				
				/* currentHBox.setStyle("paddingTop",1);
				currentHBox.setStyle("paddingBottom",1);
				currentHBox.setStyle("paddingLeft",1);
				currentHBox.setStyle("paddingRight",1); */
				
				currentHBox.removeEventListener(MouseEvent.MOUSE_OUT, eventMouseOut);
				
				//unhighlight all events from the event list
				var i:int;
				for(i=0; i<getParentProject.eventInfoList.eventList.length; i++)
				{
					var eventHBox:HBox = new HBox();
					eventHBox = getParentProject.eventInfoList.getChildByName(getParentProject.eventInfoList.eventList[i].pk + "event") as HBox;
					//eventHBox.setStyle("borderStyle", "none");
					eventHBox.opaqueBackground = 0xffffff;		
					
					/* eventHBox.setStyle("paddingTop",1);
					eventHBox.setStyle("paddingBottom",1);
					eventHBox.setStyle("paddingLeft",1);
					eventHBox.setStyle("paddingRight",1); */					
				} 
			}
			
     	]]>
     </mx:Script>
</mx:Panel>
